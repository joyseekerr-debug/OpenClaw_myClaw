# 数据源字段映射检查报告

**检查时间:** 2026-02-24  
**检查范围:** 股票交易预测系统所有数据源

---

## 1. iTick 数据源

### 当前状态
- ⚠️ **使用模拟数据**
- 实际API需要官方SDK

### 字段映射 (当前实现)
```python
'timestamp': 时间戳
'symbol': 股票代码
'price': 最新价格
'volume': 成交量
'bid': 买价
'ask': 卖价
'bid_volume': 买量
'ask_volume': 卖量
```

### 风险等级: 🔴 **高风险**

### 问题
1. 使用模拟数据，字段映射未经验证
2. 实际API字段可能不同
3. 缺乏官方文档验证

### 建议操作
- [ ] 接入真实iTick API
- [ ] 打印原始响应验证字段
- [ ] 参考官方SDK文档确认字段映射
- [ ] 进行计算验证（涨跌额、涨跌幅）

---

## 2. Yahoo Finance 数据源

### 当前状态
- ✅ **标准列名映射**
- 使用yfinance库

### 字段映射
```python
# 历史数据
'Date' -> 'timestamp'
'Open' -> 'open'
'High' -> 'high'
'Low' -> 'low'
'Close' -> 'close'
'Volume' -> 'volume'
'Dividends' -> (removed)
'Stock Splits' -> (removed)
```

### 风险等级: 🟢 **低风险**

### 说明
- 使用标准yfinance库列名
- 列名转换明确
- 但Yahoo对港股数据有延迟

### 建议操作
- [x] 字段映射已标准化
- [ ] 验证港股数据实时性
- [ ] 检查数据延迟情况

---

## 3. AKShare 数据源

### 当前状态
- ⚠️ **使用中文字段名**
- 实时数据字段待验证

### 历史数据字段映射
```python
'日期' -> 'timestamp'
'开盘' -> 'open'
'收盘' -> 'close'
'最高' -> 'high'
'最低' -> 'low'
'成交量' -> 'volume'
'成交额' -> 'amount'
'振幅' -> 'amplitude'
'涨跌幅' -> 'pct_change'
'涨跌额' -> 'change_amount'
'换手率' -> 'turnover'
```

### 实时数据字段 (待验证)
```python
'代码' -> code
'名称' -> name
'最新价' -> latest_price
'涨跌幅' -> change_pct
'涨跌额' -> change_amount
'成交量' -> volume
'成交额' -> amount
'开盘价' -> open
'最高价' -> high
'最低价' -> low
'昨收' -> prev_close
```

### 风险等级: 🟡 **中风险**

### 问题
1. 实时数据字段名基于假设
2. 中文字段名可能与实际返回不一致
3. 未经截图验证

### 建议操作
- [ ] 测试AKShare实时数据获取
- [ ] 打印原始DataFrame列名
- [ ] 验证字段名与实际返回一致
- [ ] 进行计算验证

---

## 4. 新浪财经 (新增)

### 当前状态
- ✅ **已修正并验证**
- 与小米集团截图数据一致

### 字段映射 (已验证)
```python
[0] 'XIAOMI-W' -> name (英文名称)
[1] '小米集团-W' -> (中文名称)
[2] '36.080' -> open (开盘价) ✅
[3] '36.560' -> prev_close (昨收) ✅
[4] '36.480' -> high (最高价) ✅
[5] '35.440' -> low (最低价) ✅
[6] '35.740' -> price (收盘价/最新价) ✅
[7] '-0.820' -> change (涨跌额) ✅
[8] '-2.243' -> change_pct (涨跌幅%) ✅
[9] '35.740' -> bid (买价)
[10] '35.760' -> ask (卖价)
[12] '142300259' -> volume (成交量)
[18] '16:08:12' -> market_time (市场时间)
```

### 风险等级: 🟢 **已验证**

### 验证结果
- ✅ 收盘价: 35.740
- ✅ 开盘价: 36.080
- ✅ 最高价: 36.480
- ✅ 最低价: 35.440
- ✅ 昨收: 36.560
- ✅ 涨跌: -0.820
- ✅ 涨跌幅: -2.243%

### 计算验证
```
35.740 - 36.560 = -0.820 ✅
-0.820 / 36.560 = -2.243% ✅
```

---

## 总体评估

| 数据源 | 风险等级 | 状态 | 需要操作 |
|--------|----------|------|----------|
| iTick | 🔴 高风险 | 模拟数据 | 接入真实API并验证 |
| Yahoo Finance | 🟢 低风险 | 标准列名 | 验证港股延迟 |
| AKShare | 🟡 中风险 | 字段待验证 | 测试实时数据 |
| 新浪财经 | 🟢 已验证 | 截图确认 | 已完成 |

---

## 下一步行动

### 高优先级
1. **iTick数据源**
   - 安装官方SDK
   - 连接真实API
   - 打印原始响应
   - 验证字段映射

2. **AKShare实时数据**
   - 测试stock_hk_spot_em
   - 确认返回的列名
   - 验证字段映射正确性

### 中优先级
3. **交叉验证**
   - 多个数据源对比
   - 确保数据一致性
   - 建立数据质量监控

---

## 预防措施

1. **所有新数据源必须:**
   - 打印原始响应
   - 与实际数据对比验证
   - 计算验证关键指标
   - 截图或文档确认

2. **代码审查 checklist:**
   - [ ] 字段映射是否有文档支持
   - [ ] 是否进行了计算验证
   - [ ] 是否与实际数据对比
   - [ ] 是否有异常处理

---

**报告生成:** 2026-02-24  
**检查人:** AI Assistant
