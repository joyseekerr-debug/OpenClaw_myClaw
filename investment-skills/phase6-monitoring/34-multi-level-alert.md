# 34. 多级预警机制 (Multi-level Alert Mechanism)

## 概念定义

多级预警机制是指根据风险或异常的严重程度，设置不同级别的预警，并采取相应的通知方式和响应措施的体系化设计。

## 预警级别设计

### 四级预警体系
```
┌─────────────────────────────────────────────────────┐
│  级别1：紧急（Critical）                            │
│  ├── 触发条件：重大风险事件                         │
│  │   - 风险限额突破50%以上                          │
│  │   - 组合单日回撤超5%                             │
│  │   - 系统故障                                     │
│  │   - 重大市场异常                                 │
│  ├── 响应时间：立即（<1分钟）                      │
│  ├── 通知方式：电话+短信+飞书+邮件                  │
│  └── 响应措施：自动风控+人工介入                    │
├─────────────────────────────────────────────────────┤
│  级别2：重要（Major）                               │
│  ├── 触发条件：显著风险信号                         │
│  │   - 风险限额突破20-50%                           │
│  │   - 组合回撤2-5%                                 │
│  │   - 重要技术指标信号                             │
│  │   - 持仓标的大幅波动                             │
│  ├── 响应时间：5分钟内                              │
│  ├── 通知方式：飞书+短信                            │
│  └── 响应措施：人工审核+准备应对                    │
├─────────────────────────────────────────────────────┤
│  级别3：一般（Minor）                               │
│  ├── 触发条件：关注信号                             │
│  │   - 风险限额突破10-20%                           │
│  │   - 价格触及预警线                               │
│  │   - 一般技术指标信号                             │
│  ├── 响应时间：30分钟内                             │
│  ├── 通知方式：飞书推送                             │
│  └── 响应措施：记录关注+定时检查                    │
├─────────────────────────────────────────────────────┤
│  级别4：提示（Info）                                │
│  ├── 触发条件：日常提醒                             │
│  │   - 日终报告                                     │
│  │   - 定期汇总                                     │
│  │   - 非紧急信息                                   │
│  ├── 响应时间：定时                                 │
│  ├── 通知方式：邮件/应用内                          │
│  └── 响应措施：查阅参考                             │
└─────────────────────────────────────────────────────┘
```

## 通知升级机制

### 自动升级
```
时间升级：
- 紧急预警未处理 → 5分钟后升级通知
- 重要预警未处理 → 30分钟后升级通知

级别升级：
- 一般预警持续触发 → 升级为重要
- 连续多个一般预警 → 合并升级为重要

范围升级：
- 单个标的异常 → 关注同板块其他标的
- 单个策略异常 → 检查相关策略
```

### 人工升级
```
交易员升级：
- 发现重大风险 → 立即上报
- 手动触发紧急预警

风控升级：
- 监控发现系统性风险
- 手动触发全员通知
```

## 分级响应流程

### 紧急响应流程
```
触发 → 即时通知 → 自动风控 → 人工确认 → 后续处理

自动风控措施：
1. 暂停新增交易
2. 启动预设对冲
3. 减仓至安全水平
4. 记录事件日志

人工确认后：
1. 评估自动措施是否充分
2. 决定是否进一步行动
3. 向上级汇报
4. 制定恢复计划
```

### 重要响应流程
```
触发 → 5分钟内通知 → 人工评估 → 决策行动

评估内容：
- 是否误判
- 风险程度评估
- 应对措施选择

行动选项：
1. 忽略（误报）
2. 加强监控
3. 调整仓位
4. 启动对冲
5. 升级为紧急
```

## 通知渠道与级别匹配

| 级别 | 飞书 | 短信 | 电话 | 邮件 | 应用内 |
|------|------|------|------|------|--------|
| 紧急 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 重要 | ✅ | ✅ | ❌ | ✅ | ✅ |
| 一般 | ✅ | ❌ | ❌ | ❌ | ✅ |
| 提示 | ❌ | ❌ | ❌ | ✅ | ✅ |

## 预警疲劳管理

### 问题识别
```
预警疲劳表现：
- 大量预警无人处理
- 重要预警被忽视
- 用户关闭通知

原因分析：
- 阈值设置过严
- 重复预警过多
- 误报率高
```

### 解决方案
```
1. 智能聚合
   - 同类型预警合并
   - 同标的预警聚合
   - 定时汇总替代实时推送

2. 动态阈值
   - 根据市场波动调整
   - 根据历史触发频率优化
   - 个性化阈值设置

3. 静默规则
   - 非交易时间静默
   - 已处理预警不再重复
   - 用户可自定义免打扰

4. 反馈学习
   - 标记误报/有效预警
   - 机器学习优化算法
   - 持续改进预警质量
```

## 多级预警配置示例

```yaml
# 预警配置示例
alerts:
  - name: "单日回撤"
    levels:
      critical:
        threshold: -0.05  # -5%
        channels: [feishu, sms, phone]
        cooldown: 0
      major:
        threshold: -0.02  # -2%
        channels: [feishu, sms]
        cooldown: 300  # 5分钟
      minor:
        threshold: -0.01  # -1%
        channels: [feishu]
        cooldown: 1800  # 30分钟

  - name: "价格触发"
    levels:
      major:
        condition: "price >= target_price"
        channels: [feishu]
        cooldown: 3600
```

---
*文档版本：v1.0 | 投资技能学习系列*
