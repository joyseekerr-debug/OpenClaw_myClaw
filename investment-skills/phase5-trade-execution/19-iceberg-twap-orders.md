# 19. 冰山单与TWAP (Iceberg Orders & TWAP)

## 概念定义

**冰山单（Iceberg Order）**：大额订单拆分执行，仅显示部分数量，成交后自动补充，隐藏真实交易意图。

**TWAP（Time-Weighted Average Price）**：时间加权平均价格算法，在指定时间段内均匀执行订单，使成交均价接近该时段的市场时间加权平均价。

## 冰山单详解

### 工作原理
```
真实订单：卖出10,000手
冰山单设置：显示数量1,000手

执行过程：
1. 市场看到：卖出 1,000手
2. 成交1,000手后，自动补充1,000手
3. 重复直至全部成交

市场感知：
- 以为只是小额卖单
- 不会引起恐慌
- 避免价格冲击
```

### 冰山单参数
```
1. 总数量：实际要成交的总量
2. 显示数量：每笔显示的数量
3. 补充条件：
   - 完全成交后补充
   - 部分成交后补充
4. 价格类型：限价/市价
```

### 冰山单优缺点

✅ **优点**
- 隐藏真实交易规模
- 减少市场冲击
- 避免跟风交易
- 适合大额建仓/平仓

❌ **缺点**
- 可能无法全部成交
- 成交时间不确定
- 部分市场不支持
- 可能产生更高交易成本

### 应用场景
```
1. 机构大额交易
   - 基金调仓
   - 指数成分股调整

2. 避免信息泄露
   - 董监高减持
   - 重要股东交易

3. 被动投资策略
   - ETF申购赎回
   - 量化策略执行
```

## TWAP算法详解

### 算法原理
```
目标：成交均价 ≈ 时段内市场TWAP

公式：
TWAP = Σ(成交价 × 成交量) / Σ成交量

执行策略：
- 将订单均匀分散到时间段内
- 每段时间内完成固定比例
- 忽略价格波动，按计划执行
```

### TWAP执行示例
```
订单：买入10,000股
时间窗口：2小时（120分钟）
切片：每10分钟执行一次，共12次
每次数量：10,000 / 12 ≈ 833股

执行计划：
09:30 买入 833股
09:40 买入 833股
09:50 买入 833股
...
11:20 买入 833股

特点：
- 机械执行，不受价格影响
- 成交均价接近市场均价
- 市场冲击最小化
```

### TWAP vs VWAP

| 维度 | TWAP | VWAP |
|------|------|------|
| 目标基准 | 时间加权均价 | 成交量加权均价 |
| 执行逻辑 | 均匀时间切片 | 按预测成交量切片 |
| 复杂度 | 简单 | 较复杂 |
| 适用场景 | 流动性充足 | 流动性变化大 |

## 其他算法交易订单

### VWAP（成交量加权平均价格）
```
原理：
- 预测日内成交量分布
- 按成交量比例执行
- 大成交量时段多执行，小成交量时段少执行

优势：
- 成交均价接近市场VWAP
- 隐藏于正常成交量中
- 业界最常用的算法之一
```

### POV（Percent of Volume）
```
原理：
- 参与固定比例的成交量
- 如设置为20%，则每成交100股跟单20股

特点：
- 自动适应市场活跃度
- 高波动时自动减少执行
- 低波动时增加执行
```

### Implementation Shortfall（执行缺口）
```
目标：最小化决策价与实际成交价的差异

考虑因素：
- 市场冲击成本
- 机会成本（未成交部分的价格变动）
- 时间风险
- 交易延迟

适用：
- 对价格敏感的大额订单
- 要求快速完成的交易
```

## 算法交易选择指南

| 场景 | 推荐算法 | 原因 |
|------|----------|------|
| 不急于成交 | TWAP | 均匀分布，冲击小 |
| 跟踪市场均价 | VWAP | 业界标准基准 |
| 快速完成 | IS | 最小化执行缺口 |
| 隐藏意图 | 冰山单/POV | 隐藏真实规模 |
| 自适应市场 | POV | 随成交量调整 |

## 散户可用替代方案

### 分批下单
```
大额订单手动拆分：
- 将10,000股拆分为10笔1,000股
- 间隔时间执行（如每10分钟）
- 模拟TWAP效果
```

### 条件单组合
```
设置多个价格条件单：
- 买入价100元：1,000股
- 买入价99.5元：1,000股
- 买入价99元：1,000股

效果：
- 越跌买越多
- 平均成本接近区间均价
```

---
*文档版本：v1.0 | 投资技能学习系列*
