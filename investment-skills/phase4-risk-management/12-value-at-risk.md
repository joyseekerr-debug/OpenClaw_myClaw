# 12. VaR计算 (Value at Risk)

## 概念定义

风险价值（Value at Risk, VaR）是在给定置信水平和时间范围内，投资组合可能遭受的最大损失。它将多种风险因素综合为一个数字，便于理解和沟通。

> "在95%置信水平下，1天VaR为100万元"意味着：正常市场条件下，明天损失超过100万的概率只有5%。

## 数学表达

### 定义公式
```
P(L > VaR) = 1 - α

其中：
L = 损失（正数表示损失）
α = 置信水平（如95%、99%）
VaR = 风险价值
```

### 三种计算方法

#### 1. 历史模拟法
```
步骤：
1. 收集过去N个周期的收益率数据
2. 计算当前组合在这些历史情景下的损益
3. 按从小到大排序
4. VaR = 第(1-α)×N百分位的损失

示例：1000天历史数据，95%置信度
VaR = 第50大损失（排序后第950位）
```

#### 2. 方差-协方差法（参数法）
```
假设收益率服从正态分布：
VaR = 组合价值 × (μ - Zα × σ)

其中：
μ = 预期收益率
σ = 组合波动率
Zα = 标准正态分布的分位数

常用Z值：
90% → 1.28
95% → 1.65
99% → 2.33
```

#### 3. 蒙特卡洛模拟法
```
步骤：
1. 建立资产价格随机模型
2. 生成大量随机情景（如10,000次）
3. 计算每种情景下的组合价值
4. VaR = (1-α)分位数的损失
```

## VaR计算示例

### 单一资产示例
```
持仓：100万元某股票
日波动率：2%
置信度：95%

方差-协方差法：
VaR = 1,000,000 × 1.65 × 2% = 33,000元

结论：95%概率下，明天损失不超过3.3万元
```

### 组合VaR示例
```
资产A：60万，波动率15%，权重60%
资产B：40万，波动率20%，权重40%
相关系数：0.3

组合波动率：
σp = √(0.6²×0.15² + 0.4²×0.20² + 2×0.6×0.4×0.15×0.20×0.3)
   = 13.6%

组合VaR(95%,1年)：
VaR = 1,000,000 × 1.65 × 13.6% = 224,400元
```

## VaR的局限性与补充

### 局限性
❌ **尾部风险盲区**
- 只告诉损失不超过X的概率
- 不告诉超过X时会损失多少

❌ **正态分布假设**
- 金融收益率有肥尾特征
- 极端事件比正态分布更频繁

❌ **不满足次可加性**
- VaR(A+B)可能 > VaR(A) + VaR(B)
- 不符合风险分散直觉

### 补充指标

#### CVaR/ES（期望损失）
```
CVaR = E[L | L > VaR]

含义：当损失超过VaR时的平均损失
```

#### 压力测试
- 模拟极端情景
- 补充VaR的盲区

## VaR应用

### 风险限额设定
```
交易员日VaR限额：$50,000
部门周VaR限额：$500,000
公司年VaR限额：$50,000,000
```

### 资本充足率
- 巴塞尔协议要求银行按VaR计提资本
- 确保有足够资金应对潜在损失

### 绩效评估
```
风险调整收益 = 实际收益 / VaR

比较不同交易员/策略的风险效率
```

## VaR参数选择

| 参数 | 常用值 | 适用场景 |
|------|--------|----------|
| 置信度 | 95% | 日常风险管理 |
| 置信度 | 99% | 监管报告 |
| 时间周期 | 1日 | 交易风险 |
| 时间周期 | 10日 | 巴塞尔要求 |
| 时间周期 | 1年 | 战略资产配置 |

---
*文档版本：v1.0 | 投资技能学习系列*
