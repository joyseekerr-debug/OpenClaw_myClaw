# Phase 3-7: 量价因子

## 一、概念定义

### 1.1 量价因子概述
基于股票价格和成交量数据构建的Alpha因子，利用市场微观结构信息预测未来收益。

**核心思想：**
- 成交量验证价格：成交量放大的价格变动更可靠
- 量价背离预警：价格与成交量的背离预示转折
- 流动性信息：成交量反映市场参与度和信息传播
- 供需关系：成交量揭示买卖力量对比

### 1.2 量价关系基础

**经典量价理论：**
```
价升量增：上涨趋势确认，健康上涨
价升量缩：上涨动能不足，可能回调
价跌量增：下跌趋势确认，恐慌抛售
价跌量缩：抛压减轻，可能企稳
量价背离：价格与成交量趋势相反，预警信号
```

**信息论视角：**
```
成交量作为信息载体：
• 高成交量 = 高信息含量
• 价格变动需成交量确认
• 异常成交量 = 异常信息流
```

### 1.3 量价因子分类

| 类别 | 核心逻辑 | 典型因子 |
|------|----------|----------|
| 能量类 | 成交量与价格结合的能量 | OBV、ADL、MFI |
| 趋势确认类 | 成交量验证价格趋势 | 量价趋势、PVT |
| 波动类 | 量价波动特征 | 振幅、量比 |
| 资金流类 | 资金流向分析 | 资金流量、CMF |
| 微观结构类 | 订单簿与成交细节 | 订单不平衡、VPIN |

---

## 二、算法原理

### 2.1 能量类因子

**OBV（能量潮指标）**
```
计算公式：
当日OBV = 前日OBV + sign(今日close - 昨日close) × 今日volume

其中 sign(x) = 1 if x > 0, -1 if x < 0, 0 if x = 0

原理：
• 上涨日的成交量累加
• 下跌日的成交量累减
• OBV领先价格预示趋势

变形：
• OBV的移动平均线
• OBV的动量（变化率）
• OBV与价格的背离
```

**ADL（累积/派发线）**
```
计算公式：
CLV = [(close - low) - (high - close)] / (high - low)
ADL = 前日ADL + CLV × volume

原理：
• 考虑当日高低点位置
• 收盘价接近高点 → 正向累积
• 收盘价接近低点 → 负向派发
```

**MFI（资金流量指标）**
```
计算公式：
典型价格 TP = (high + low + close) / 3
资金流量 MF = TP × volume

MFI = 100 - 100 / (1 + 正MF14日总和 / 负MF14日总和)

特点：
• 结合价格和成交量的RSI变体
• 超买（>80）/超卖（<20）信号
```

### 2.2 趋势确认类因子

**量价趋势（Price Volume Trend）**
```
计算公式：
PVT = 前日PVT + (今日close - 昨日close) / 昨日close × 今日volume

或：
PVT = Σ(收益率 × 成交量)

原理：
• 用收益率加权成交量
• 与OBV类似但更敏感
• 适合判断趋势强度
```

**量价配合度因子**
```
计算公式：
配合度 = 收益率 × sign(成交量变化) × |成交量变化率|

或：
配合度 = correlation(收益率序列, 成交量序列, 20日)

解读：
• 正相关 = 量价配合良好
• 负相关 = 量价背离，需警惕
```

### 2.3 波动类因子

**振幅因子**
```
计算公式：
振幅 = (high - low) / open × 100%

变形因子：
• 真实波幅 ATR
• 振幅/成交量比
• 振幅变化率

应用：
• 高振幅预示高波动
• 结合成交量判断有效性
```

**量比因子**
```
计算公式：
量比 = 当日成交量 / 过去N日平均成交量

解读：
• 量比 > 2：成交量显著放大
• 量比 < 0.5：成交量明显萎缩
• 放量上涨/下跌的信号强度
```

### 2.4 资金流类因子

**资金流量因子（CMF）**
```
计算公式：
资金流量乘数 = [(close - low) - (high - close)] / (high - low)
资金流量量 = 资金流量乘数 × volume
CMF = SUM(资金流量量, n) / SUM(volume, n)

取值范围：-1 到 +1
• 正值：资金流入
• 负值：资金流出
```

**大单资金因子**
```
定义大单：
• 单笔成交量 > 阈值（如均值+2σ）
• 或按金额分级

因子计算：
• 大单净流入 = 大单买入金额 - 大单卖出金额
• 大单占比 = 大单成交量 / 总成交量
• 大单持续流入天数

逻辑：
• 大单代表机构行为
• 持续大单流入预示积极信号
```

### 2.5 微观结构类因子

**订单不平衡（Order Imbalance）**
```
计算公式：
OIB = (主动买入量 - 主动卖出量) / 总成交量

主动买卖判别：
• 逐笔成交数据：成交方向
• 盘口数据：委托方向变化

应用：
• OIB > 0：买方占优
• OIB持续性：趋势持续性
```

**VPIN（成交量同步知情交易概率）**
```
计算步骤：
1. 将时间划分为等成交量区间
2. 计算每个区间的买卖不平衡
3. VPIN = 平均 |买卖不平衡|

解读：
• VPIN上升：知情交易增加
• 高VPIN预示波动可能加剧
• 常用于高频风险预警
```

---

## 三、应用场景

### 3.1 量价选股策略

**放量突破策略**
```
信号条件：
1. 价格突破前高（或均线）
2. 成交量显著放大（量比 > 2）
3. OBV呈上升趋势

过滤条件：
• 避免高位放量滞涨
• 结合趋势方向
• 考虑市场整体环境
```

**缩量回调策略**
```
信号条件：
1. 上涨趋势中的回调
2. 成交量明显萎缩（量比 < 0.8）
3. 价格在关键支撑位

逻辑：
• 缩量表示抛压减轻
• 健康的上涨需要缩量整理
• 重新放量时介入
```

**量价背离预警**
```
顶背离：
• 价格创新高，OBV未创新高
• 预示上涨动能减弱
• 考虑减仓或观望

底背离：
• 价格创新低，OBV未创新低
• 预示下跌动能减弱
• 关注反弹机会
```

### 3.2 量价因子在Alpha模型中的应用

**单因子检验结果参考**
```
动量类量价因子：
• IC均值：0.03-0.05
• 逻辑：趋势延续需要成交量确认

反转类量价因子：
• IC均值：0.02-0.04
• 逻辑：极端量价组合后的均值回归

流动性类量价因子：
• IC均值：0.02-0.03
• 逻辑：低流动性股票有流动性溢价
```

**多因子组合**
```
量价因子常与以下因子结合：
• 趋势因子：量价确认趋势强度
• 波动因子：量 price印证波动
• 情绪因子：成交量反映市场情绪

组合方法：
• 等权组合
• IC加权
• 分层筛选（先量价筛选，再其他因子）
```

### 3.3 高频量价因子

**日内量价特征**
```
开盘量价比：
• 开盘成交量/日平均成交量
• 高开盘量预示当日活跃

尾盘量价比：
• 收盘前30分钟成交量特征
• 尾盘放量反映机构调仓

日内量价分布：
• U型：两端活跃（开盘、收盘）
• 倒U型：中间活跃（异常）
```

**Tick级因子**
```
成交方向因子：
• 主动买入/卖出比例
• 大单方向持续性

订单簿因子：
• 买卖挂单不平衡
• 挂单深度变化
• 订单簿斜率（价格弹性）

成交序列因子：
• 连续同方向成交次数
• 成交间隔时间
• 成交价格跳跃特征
```

---

## 四、注意事项

### 4.1 量价因子的局限性

**噪声问题**
```
成交量包含：
• 信息交易（信号）
• 流动性需求（噪声）
• 再平衡交易（噪声）
• 对冲交易（噪声）

问题：
• 信号与噪声难以分离
• 高成交量不一定代表有效信号

应对：
• 结合价格形态分析
• 使用多周期确认
• 考虑市场环境
```

**操纵风险**
```
对倒交易：
• 人为制造高成交量
• 误导市场参与者

诱多/诱空：
• 放量拉升吸引跟风
• 然后反向操作

识别方法：
• 关注大单与小单比例
• 分析订单簿深度
• 结合基本面信息
```

### 4.2 计算细节陷阱

**复权影响**
```
问题：
• 除权除息导致成交量突变
• 配股、增发影响可比性

处理：
• 成交量不复权
• 注意股本变动事件
• 使用换手率替代绝对成交量
```

**时间对齐**
```
问题：
• 集合竞价成交量归属
• 不同市场的交易时间差异
• 跨市场量比计算

处理：
• 明确定义时间边界
• 统一处理集合竞价
• 考虑时区影响
```

### 4.3 参数敏感性

**周期选择影响**
```
不同周期的量价关系可能不同：
• 日线：适合判断中期趋势
• 小时线：适合判断短期动量
• 分钟线：适合微观结构分析

建议：
• 测试多组参数
• 避免过度优化
• 选择经济逻辑最清晰的参数
```

### 4.4 市场环境适应性

**量价关系的变化**
```
牛市环境：
• 价升量增更常见
• 缩量调整健康
• 量价背离较少

熊市环境：
• 价跌量增常见
• 反弹往往缩量
• 量价背离频繁

震荡市：
• 量价关系不稳定
• 假突破多
• 需要更严格的确认条件
```

---

## 五、核心概念总结

```
┌─────────────────────────────────────────────────────────┐
│                  量价因子核心框架                        │
├─────────────────────────────────────────────────────────┤
│  理论基础                                              │
│  ├── 成交量验证价格：有效变动需成交量确认               │
│  ├── 量价背离预警：背离预示潜在转折                     │
│  └── 流动性信息：成交量反映市场参与度                   │
├─────────────────────────────────────────────────────────┤
│  因子分类                                              │
│  ├── 能量类：OBV、ADL、MFI（累积成交量）                │
│  ├── 趋势确认：PVT、量价趋势、配合度                    │
│  ├── 波动类：振幅、ATR、量比                            │
│  ├── 资金流：CMF、大单资金、净流入                      │
│  └── 微观结构：OIB、VPIN、订单簿特征                    │
├─────────────────────────────────────────────────────────┤
│  应用场景                                              │
│  ├── 放量突破：趋势确认信号                             │
│  ├── 缩量回调：健康整理信号                             │
│  ├── 量价背离：转折预警信号                             │
│  └── 微观结构：高频交易信号                             │
├─────────────────────────────────────────────────────────┤
│  关键注意                                              │
│  ├── 信号与噪声：成交量包含多种成分                     │
│  ├── 操纵风险：警惕人为制造量                           │
│  ├── 市场环境：量价关系随市场状态变化                   │
│  └── 复权处理：成交量不复权，注意股本变动               │
└─────────────────────────────────────────────────────────┘
```

---

*文档创建时间：2026-02-24*  
*所属阶段：Phase 3 - 量化技能（第7/20项）*
