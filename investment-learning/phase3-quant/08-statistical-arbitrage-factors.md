# Phase 3-8: 统计套利因子

## 一、概念定义

### 1.1 统计套利（Statistical Arbitrage）
利用统计方法和数学模型，识别资产价格间的暂时性偏离并进行交易，期望价格关系回归历史均值时获利。

**核心特征：**
- **市场中性**：多空同时持有，对冲市场风险
- **统计驱动**：基于历史统计规律而非基本面
- **均值回归**：假设价格关系长期稳定
- **高频交易**：通常持仓周期较短

**与风险套利的区别：**
| 维度 | 统计套利 | 风险套利 |
|------|----------|----------|
| 基础 | 统计关系 | 确定性事件 |
| 风险 | 模型风险 | 事件风险 |
| 收益 | 稳定小额 | 不确定大额 |
| 时间 | 短期 | 中期 |

### 1.2 配对交易（Pairs Trading）
统计套利中最经典的策略，选择历史上价格走势高度相关的两只股票，当它们的价格比率偏离历史均值时进行交易。

**基本原理：**
```
选择阶段：
• 寻找具有经济联系的股票对（同行业、上下游、替代关系）
• 或使用纯统计方法（协整检验、相关性筛选）

交易阶段：
• 价差 = 股票A价格 - β × 股票B价格
• 价差 > 上阈值：做空A，做多B（预期价差回归）
• 价差 < 下阈值：做多A，做空B
• 价差回归均值：平仓获利
```

### 1.3 协整（Cointegration）
两个或多个非平稳时间序列的线性组合是平稳的，表明它们之间存在长期均衡关系。

**与相关的区别：**
```
相关（Correlation）：
• 衡量线性关系的强度和方向
• 是同期关系，不保证长期稳定
• 两个随机游走可能虚假相关

协整（Cointegration）：
• 表明存在长期均衡关系
• 短期偏离会回归
• 是统计套利的基础

例子：
• 相关但不协整：两只股票同涨同跌但无固定比例
• 协整：两只股票价格比率长期稳定
```

---

## 二、算法原理

### 2.1 配对选择算法

**距离法（Distance Method）**
```
步骤：
1. 标准化价格序列（z-score）
2. 计算历史价格距离（SSD：Sum of Squared Differences）
3. 选择距离最小的配对

公式：
SSD = Σ(P_A_normalized - P_B_normalized)²

优点：
• 简单直观
• 计算快速

缺点：
• 不考虑价格的领先滞后关系
• 可能选出虚假配对
```

**协整检验法**
```
Engle-Granger两步法：
1. 用OLS回归：P_A = α + β × P_B + ε
2. 检验残差ε是否平稳（ADF检验）
3. 若残差平稳，则两序列协整

Johansen检验：
• 多变量协整检验
• 可检验多个协整关系
• 适合多配对组合

选择标准：
• ADF检验p值 < 0.05
• 半衰期适中（5-20天）
• 价差波动足够（有交易机会）
```

**相关系数法**
```
计算日收益率相关系数：
ρ = correlation(ret_A, ret_B)

筛选标准：
• |ρ| > 0.8（高度相关）
• 相关系数稳定（滚动窗口检验）
• 经济逻辑支撑（同行业等）
```

### 2.2 价差建模

**Ornstein-Uhlenbeck过程**
```
描述均值回归的随机过程：
dX_t = θ(μ - X_t)dt + σdW_t

其中：
• X_t：价差
• μ：长期均值
• θ：回归速度（半衰期 = ln(2)/θ）
• σ：波动率
• dW_t：维纳过程（随机项）

参数估计：
• 用历史价差数据拟合
• 可用最大似然估计或回归方法
```

**卡尔曼滤波动态对冲**
```
优势：
• 动态估计对冲比率β
• 自适应市场变化
• 比固定β更稳健

状态空间模型：
状态方程：β_t = β_{t-1} + w_t（随机游走）
观测方程：r_A = β_t × r_B + ε_t

应用：
• 实时更新最优对冲比率
• 估计价差的标准差
• 生成交易信号
```

### 2.3 交易信号生成

**阈值交易规则**
```
标准化价差：
Z_t = (X_t - μ) / σ

交易信号：
• Z_t > +2：做空价差（卖A买B）
• Z_t < -2：做多价差（买A卖B）
• |Z_t| < 0.5：平仓

参数优化：
• 进入阈值（通常1.5-2.5）
• 退出阈值（通常0-1）
• 止损阈值（避免长期偏离）
```

**时间退出规则**
```
问题：
• 价差可能长期不回归
• 资金占用成本

解决方案：
• 最大持仓时间限制（如20天）
• 半衰期倍数（如3×半衰期）
• 动态调整：根据半衰期变化
```

### 2.4 多配对组合优化

**组合构建**
```
从候选配对中选择子集：
• 相关系数矩阵筛选
• 避免高度相关的配对（多重共线性）
• 考虑资金分配效率

优化目标：
• 最大化夏普比率
• 最小化组合风险
• 满足资本约束
```

**风险控制**
```
单个配对限制：
• 最大资金占比
• 最大损失限制

组合层面：
• 行业分散
• 因子暴露控制（市值、贝塔等）
• 整体市场风险监控
```

---

## 三、应用场景

### 3.1 经典配对交易策略

**同行业配对**
```
典型配对：
• 银行业：工商银行 vs 建设银行
• 石油业：中石油 vs 中石化
• 航空业：南航 vs 东航
• 科技业：AMD vs Intel

选择逻辑：
• 受相同宏观因素影响
• 业务模式相似
• 成本结构和盈利模式可比
```

**ETF与成分股套利**
```
策略：
• ETF价格 vs 成分股组合净值
• 当折溢价超过阈值时套利

实现：
• ETF溢价：申购ETF并卖出成分股
• ETF折价：买入ETF并赎回成分股
• 需要一二级市场联动
```

**跨市场配对**
```
A+H股配对：
• 同公司在A股和H股上市
• 正常情况下价格应保持合理比例
• 汇率调整后价差套利

ADR配对：
• 美国存托凭证 vs 母国股票
• 考虑汇率和ADR比率
```

### 3.2 多因子统计套利

**原理扩展**
```
从单配对扩展到多资产：
• 不是两只股票，而是多只股票的组合
• 寻找价格关系的共同因子
• 对因子暴露进行套利

方法：
• 主成分分析（PCA）提取共同因子
• 对残差（特质收益）进行套利
• 相当于做多/做空特质收益
```

**行业中性策略**
```
构建方法：
1. 行业内部标准化（去除行业因子）
2. 在行业内选择偏离度最大的股票
3. 做多低估值，做空高估值
4. 行业中性：每个行业多空平衡

优势：
• 对冲行业风险
• 纯粹暴露于特质因子
```

### 3.3 跨资产统计套利

**期现套利**
```
股指期货 vs 现货指数：
• 理论价格：F = S × e^(r-q)T
• 当实际价差偏离理论价差时套利
• 买入低估，卖出高估

考虑因素：
• 资金成本（r）
• 股息率（q）
• 交易成本
• 保证金要求
```

**跨品种套利**
```
商品期货：
• 原油 vs 成品油（裂解价差）
• 大豆 vs 豆油 vs 豆粕（压榨价差）
• 黄金 vs 白银（金银比）

利率产品：
• 不同期限国债（收益率曲线交易）
• 国债期货 vs 现货
```

---

## 四、注意事项

### 4.1 模型风险

**结构突变（Regime Change）**
```
风险：
• 历史关系突然改变
• 协整关系破裂
• 价差不再均值回归

例子：
• 行业政策变化（如教培行业）
• 公司重大事件（并购、破产）
• 技术颠覆（如新能源对传统能源）

应对：
• 持续监控协整关系
• 设置最大损失止损
• 定期重新检验配对
```

**参数不稳定性**
```
风险：
• 对冲比率β随时间变化
• 价差波动率σ不稳定
• 均值μ发生漂移

应对：
• 使用滚动窗口估计
• 卡尔曼滤波动态更新
• 自适应阈值调整
```

### 4.2 执行风险

**滑点与冲击成本**
```
问题：
• 同时买卖两只股票难以完美执行
• 大额交易影响价格
• 价差可能在执行期间变化

解决方案：
• 算法交易拆分订单
• 使用被动订单减少冲击
• 预留滑点缓冲
```

**融券限制**
```
问题：
• 做空需要借入股票
• 某些股票难以融券
• 融券成本可能较高

影响：
• 无法执行完整的配对交易
• 只能做"单边"（只能做多价差）
• 策略容量受限
```

### 4.3 资金管理

**杠杆使用**
```
配对交易通常使用杠杆：
• 市场中性策略风险较低
• 可用杠杆放大收益

风险控制：
• 设定最大杠杆倍数
• 考虑最坏情况下的损失
• 维持保证金要求
```

**资金分配**
```
等权分配：
• 每个配对分配相同资金
• 简单但可能不是最优

风险平价：
• 根据波动率分配资金
• 高波动配对分配较少资金

凯利公式：
• 根据预期收益和风险计算最优仓位
• 实际应用中会使用"分数凯利"（如半凯利）
```

### 4.4 统计检验的陷阱

**多重检验问题**
```
问题：
• 从大量股票中筛选配对
• 偶然出现协整关系的概率增加
• 历史回测表现可能夸大

应对：
• Bonferroni校正
• 样本外验证
• 经济逻辑优先于统计结果
```

**数据窥探（Data Snooping）**
```
问题：
• 反复测试不同配对、不同参数
• 选择历史表现最好的组合
• 未来表现可能不及历史

应对：
• 预定义规则
• 留出真正的样本外数据
• 使用调整后的夏普比率
```

---

## 五、核心概念总结

```
┌─────────────────────────────────────────────────────────┐
│                统计套利核心框架                          │
├─────────────────────────────────────────────────────────┤
│  核心原理                                              │
│  ├── 均值回归：价格关系偏离后会回归                     │
│  ├── 市场中性：多空对冲消除系统性风险                   │
│  └── 统计驱动：基于历史规律而非基本面                   │
├─────────────────────────────────────────────────────────┤
│  配对选择                                              │
│  ├── 距离法：价格距离最小化                             │
│  ├── 协整检验：Engle-Granger / Johansen                 │
│  └── 经济逻辑：同行业、上下游关系                       │
├─────────────────────────────────────────────────────────┤
│  建模方法                                              │
│  ├── 静态OLS：固定对冲比率                              │
│  ├── 动态卡尔曼：自适应对冲比率                         │
│  └── OU过程：均值回归参数建模                           │
├─────────────────────────────────────────────────────────┤
│  交易执行                                              │
│  ├── 信号生成：Z-score阈值突破                          │
│  ├── 仓位管理：资金分配与杠杆控制                       │
│  └── 风险控制：止损、时间退出、再平衡                   │
├─────────────────────────────────────────────────────────┤
│  主要风险                                              │
│  ├── 结构突变：历史关系突然改变                         │
│  ├── 执行风险：滑点、融券限制                           │
│  ├── 模型风险：参数不稳定、过度拟合                     │
│  └── 容量限制：策略规模受限                             │
└─────────────────────────────────────────────────────────┘
```

---

*文档创建时间：2026-02-24*  
*所属阶段：Phase 3 - 量化技能（第8/20项）*
