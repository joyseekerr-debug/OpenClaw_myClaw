# MEMORY.md - 长期记忆

_这是我的长期记忆文件，存储重要的决策、偏好和教训。_

## 关于用户

- **名称**: 
- **称呼**: 
- **时区**: Asia/Shanghai
- **偏好**: 

## 重要决策

- 

## 重要安全规则

### 金融数据使用规范
- **模拟数据只能用于测试或调试**
- **严禁使用模拟数据进行实际交易决策**
- 生产环境必须使用真实数据源
- 所有数据必须明确标注来源类型 (real/simulated)

### 数据映射验证规则 (2026-02-24)
**严重错误教训:** 新浪财经港股数据字段映射错误

**后果:**
- 提供了错误的股价数据
- 可能影响交易决策

**根本原因:**
- 未验证数据格式文档
- 未与实际数据进行交叉验证
- 凭假设进行字段映射

**强制验证流程 (以后必须执行):**
1. **查找官方文档** - 确认API数据格式
2. **打印原始数据** - 查看所有字段原始值
3. **交叉验证** - 与实际交易软件数据对比
4. **计算验证** - 验证涨跌额、涨跌幅计算是否正确
5. **多源对比** - 与其他数据源对比确认

**必须验证的数据项:**
- 开盘价、收盘价、最高价、最低价
- 成交量、成交额
- 涨跌额、涨跌幅 (必须计算验证)
- 昨日收盘价

**禁止行为:**
- ❌ 未经验证就使用字段映射
- ❌ 凭猜测假设字段含义
- ❌ 不进行交叉验证就发布数据

## 经验教训

- 

### iTick API 配置与字段映射 (2026-02-24)

**API端点:**
- 地址: `https://api-free.itick.org/stock`
- 认证: `token: API_KEY` (不是Bearer)

**港股代码格式:**
- 错误: `code='1810.HK'`
- 正确: `code='1810'` (无.HK后缀), `region='HK'`

**已验证的字段映射:**
| 字段 | 含义 | 验证方式 |
|------|------|----------|
| `s` | 股票代码 | - |
| `p` | 昨收价 | 与新浪财经[3]对比 ✅ |
| `ld` | 收盘价/最新价 | 与新浪财经[6]对比 ✅ |
| `o` | 开盘价 | 与新浪财经[2]对比 ✅ |
| `h` | 最高价 | 与新浪财经[4]对比 ✅ |
| `l` | 最低价 | 与新浪财经[5]对比 ✅ |
| `ch` | 涨跌额 | 计算: ld - p = ch ✅ |
| `chp` | 涨跌幅% | 计算: (ld-p)/p*100 = chp ✅ |
| `v` | 成交量 | - |
| `tu` | 成交额 | - |

**验证数据 (小米集团1810.HK):**
- 收盘价: 35.74 (iTick) = 35.740 (新浪) ✅
- 开盘价: 36.08 (iTick) = 36.080 (新浪) ✅
- 最高价: 36.48 (iTick) = 36.480 (新浪) ✅
- 最低价: 35.44 (iTick) = 35.440 (新浪) ✅

**重要教训:**
- API地址必须从官方文档获取，不能臆想
- 港股代码格式有特殊要求 (无.HK后缀)
- 认证方式必须按文档要求 (`token` header)

### 新浪财经港股字段映射 (已验证)

**数据格式:** `var hq_str_rt_hk01810="..."`

| 索引 | 字段 | 含义 | 验证 |
|------|------|------|------|
| [0] | 英文名称 | name | - |
| [1] | 中文名称 | - | - |
| [2] | 开盘价 | open | ✅ |
| [3] | 昨收价 | prev_close | ✅ |
| [4] | 最高价 | high | ✅ |
| [5] | 最低价 | low | ✅ |
| [6] | 收盘价/最新价 | price | ✅ |
| [7] | 涨跌额 | change | ✅ |
| [8] | 涨跌幅% | change_pct | ✅ |
| [9] | 买价 | bid | - |
| [10] | 卖价 | ask | - |
| [12] | 成交量 | volume | - |
| [18] | 市场时间 | market_time | - |

## 项目上下文

### 股票交易预测系统 (v0.1.0)
- **项目路径:** `stock-trading-system/`
- **主要数据源:** 新浪财经 (已验证), iTick (已验证)
- **目标股票:** 小米集团 (1810.HK)
- **数据源状态:**
  - 新浪财经: ✅ 已验证
  - iTick: ✅ 已验证
  - Yahoo Finance: 🟡 标准列名
  - AKShare: 🟡 待验证

### API Keys (已配置)
- iTick: `62842c85df6f4665a50620efb853102e609ce22b65a34a41a0a9d3af2685caf1`

## 更新记录

- 2026-02-23: 初始化记忆文件
- 2026-02-24: 添加金融数据使用规范
- 2026-02-24: 添加数据映射验证规则
- 2026-02-24: **添加iTick API配置与字段映射 (已验证)**
- 2026-02-24: **添加新浪财经字段映射 (已验证)**
