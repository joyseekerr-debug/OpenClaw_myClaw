# Subagent Scheduler Skill

è‡ªé€‚åº”å­ä»£ç†è°ƒåº¦ç³»ç»Ÿ - Phase 2å¢å¼ºç‰ˆ

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬:** v1.1.0 (Phase 2)
- **Phase 1:** v1.0.0 - MVPåŸºç¡€åŠŸèƒ½ âœ…
- **Phase 2:** v1.1.0 - å¢å¼ºåŠŸèƒ½ âœ…

## åŠŸèƒ½ç‰¹æ€§

### Phase 1 (å·²å®Œæˆ)
- âœ… äº”å¤§ç­–ç•¥åˆ†æ”¯ (Simple/Standard/Batch/Orchestrator/Deep)
- âœ… åŸºç¡€å†³ç­–æ ‘åˆ†ç±»
- âœ… SQLiteå†å²æ•°æ®å­˜å‚¨
- âœ… é£ä¹¦å¡ç‰‡äº¤äº’ç¡®è®¤
- âœ… å®æ—¶è¿›åº¦æ¨é€
- âœ… å¤±è´¥é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š5æ¬¡ï¼‰
- âœ… æˆæœ¬é¢„ä¼°ä¸æ§åˆ¶

### Phase 2 (å·²å®Œæˆ)
- âœ… **LLMæ™ºèƒ½åˆ†ç±»å±‚** - ä¸‰å±‚å†³ç­–å™¨ï¼ˆè§„åˆ™+å†å²+LLMï¼‰
- âœ… **æµå¼è¿›åº¦é€šçŸ¥** - å®æ—¶å‘é£ä¹¦æ¨é€æ‰§è¡Œè¿›åº¦
- âœ… **åˆ†çº§å¤±è´¥æ¢å¤** - ç­–ç•¥é™çº§ + æ£€æŸ¥ç‚¹æ¢å¤
- âœ… **åŠ æƒå¹¶å‘ç³»ç»Ÿ** - åŠ¨æ€æƒé‡åˆ†é…

### Phase 3 (è®¡åˆ’ä¸­)
- â³ è¯•æ¢æ‰§è¡Œ + åŠ¨æ€è°ƒæ•´
- â³ åˆ†å±‚ä¸Šä¸‹æ–‡å‹ç¼©
- â³ ç­–ç•¥æƒé™ç³»ç»Ÿ
- â³ åˆ†å¸ƒå¼è¿½è¸ª

## æ–‡ä»¶ç»“æ„

```
subagent-scheduler/
â”œâ”€â”€ SKILL.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ config.json                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ schema.sql                  # æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ scheduler.js                # æ ¸å¿ƒè°ƒåº¦é€»è¾‘ (Phase 2å¢å¼º)
â”œâ”€â”€ llm-classifier.js           # LLMåˆ†ç±»å±‚ (Phase 2æ–°å¢)
â”œâ”€â”€ streaming-progress.js       # æµå¼è¿›åº¦ (Phase 2æ–°å¢)
â”œâ”€â”€ retry-executor.js           # é‡è¯•ä¸æ¢å¤ (Phase 2å¢å¼º)
â”œâ”€â”€ feishu.js                   # é£ä¹¦äº¤äº’æ¨¡å—
â”œâ”€â”€ database.js                 # SQLiteæ“ä½œå°è£…
â”œâ”€â”€ cron-manager.js             # å®šæ—¶ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ cost-monitor.js             # æˆæœ¬ç›‘æ§
â”œâ”€â”€ redis-concurrency.js        # å¹¶å‘æ§åˆ¶
â”œâ”€â”€ subagent-adapter.js         # é€‚é…å™¨æ¨¡å¼
â”œâ”€â”€ feishu-callback.js          # å›è°ƒå¤„ç†
â”œâ”€â”€ index.js                    # ä¸»å…¥å£ (Phase 2å¢å¼º)
â”œâ”€â”€ test.js                     # åŸºç¡€æµ‹è¯•
â””â”€â”€ test-phase2.js              # Phase 2æµ‹è¯•
```

## ä½¿ç”¨æ–¹æ³•

```javascript
const scheduler = require('./index');

// åˆå§‹åŒ–
const sch = await scheduler.init();

// æ‰§è¡Œä»»åŠ¡ï¼ˆè‡ªåŠ¨é€‰æ‹©ç­–ç•¥ï¼‰
const result = await sch.execute({
  task: "åˆ†æè¿™10ä¸ªæ—¥å¿—æ–‡ä»¶",
  chatId: "your_feishu_chat_id"
});

// ä½¿ç”¨LLMåˆ†ç±»ï¼ˆPhase 2ï¼‰
const result = await sch.execute({
  task: "å¤æ‚ä»»åŠ¡æè¿°...",
  chatId: "your_feishu_chat_id",
  useLLM: true  // å¯ç”¨LLMåˆ†ç±»å±‚
});
```

## ä¸‰å±‚å†³ç­–å™¨ (Phase 2)

```
è¾“å…¥ï¼šä»»åŠ¡æè¿° + é™„ä»¶ + ç”¨æˆ·åå¥½
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€å±‚ï¼šå¿«é€Ÿè§„åˆ™ï¼ˆ0æˆæœ¬ï¼‰                â”‚
â”‚   - å­—æ•°<50 + æ— é™„ä»¶ â†’ Simple           â”‚
â”‚   - å«"æ‰¹é‡/æ‰€æœ‰" â†’ Batchå€™é€‰           â”‚
â”‚   - å«"è¯¦ç»†/æ·±åº¦" â†’ Deepå€™é€‰            â”‚
â”‚   - ç½®ä¿¡åº¦>0.75 â†’ ç›´æ¥è¿”å›              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ ç½®ä¿¡åº¦ä¸è¶³
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒå±‚ï¼šå†å²æ•°æ®æ ¡å‡†                     â”‚
â”‚   - æŸ¥è¯¢ç›¸ä¼¼ä»»åŠ¡å†å²                     â”‚
â”‚   - æˆåŠŸç‡>70% â†’ é‡‡ç”¨å†å²ç­–ç•¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ æ— åŒ¹é…å†å²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸‰å±‚ï¼šLLMæ™ºèƒ½åˆ†ç±» (Phase 2)            â”‚
â”‚   - è½»é‡æ¨¡å‹åˆ†æä»»åŠ¡ç‰¹å¾                 â”‚
â”‚   - ç½®ä¿¡åº¦>0.75 â†’ é‡‡ç”¨LLMå»ºè®®            â”‚
â”‚   - å¦åˆ™é™çº§åˆ°è§„åˆ™ç»“æœ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åˆ†çº§å¤±è´¥æ¢å¤ (Phase 2)

```javascript
// è‡ªåŠ¨é™çº§é“¾
Deep â†’ Standard â†’ Simple
Orchestrator â†’ Standard â†’ Simple
Batch â†’ Standard â†’ Simple
Standard â†’ Simple

// é”™è¯¯ç±»å‹å¤„ç†
- TRANSIENT (è¶…æ—¶/ç½‘ç»œ): æŒ‡æ•°é€€é¿é‡è¯•
- RESOURCE (å†…å­˜/CPU): é™çº§ç­–ç•¥
- RATE_LIMIT: å»¶é•¿é€€é¿æ—¶é—´
- LOGIC/INVALID: ä¸é‡è¯•ç›´æ¥å¤±è´¥
```

## æµå¼è¿›åº¦ (Phase 2)

```javascript
// å®æ—¶è¿›åº¦æ›´æ–°
â³ ä»»åŠ¡æ‰§è¡Œä¸­... 20%
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
ğŸ“Š åˆ†æä»»åŠ¡ä¸­...
â±ï¸ å·²ç”¨æ—¶: 12ç§’ | é¢„è®¡å‰©ä½™: 48ç§’

// å®Œæˆé€šçŸ¥
âœ… ä»»åŠ¡å®Œæˆ
æ‰§è¡Œç­–ç•¥: Standard
æ€»è€—æ—¶: 58ç§’
ç»“æœæ‘˜è¦: ...
```

## é…ç½®è¯´æ˜

```json
{
  "phase2": {
    "enabled": true,
    "llmClassifier": {
      "enabled": true,
      "model": "openai/gpt-4.1-mini",
      "confidenceThreshold": 0.75
    },
    "streamingProgress": {
      "enabled": true,
      "updateInterval": 10
    },
    "resilience": {
      "enableDowngrade": true,
      "enableCheckpoint": true
    }
  }
}
```

## æµ‹è¯•

```bash
# Phase 1åŸºç¡€æµ‹è¯•
node test.js

# Phase 2å¢å¼ºæµ‹è¯•
node test-phase2.js

# å…¨é‡æµ‹è¯•
node validate-phase1.js
```

## æ›´æ–°æ—¥å¿—

### v1.1.0 (2026-02-24) - Phase 2
- æ–°å¢LLMæ™ºèƒ½åˆ†ç±»å±‚
- æ–°å¢æµå¼è¿›åº¦é€šçŸ¥
- æ–°å¢åˆ†çº§å¤±è´¥æ¢å¤ï¼ˆé™çº§+æ£€æŸ¥ç‚¹ï¼‰
- å¢å¼ºä¸‰å±‚å†³ç­–å™¨

### v1.0.0 (2026-02-24) - Phase 1
- äº”å¤§ç­–ç•¥åˆ†æ”¯å®ç°
- åŸºç¡€å†³ç­–æ ‘åˆ†ç±»
- ç”¨æˆ·ç¡®è®¤æé†’
- æˆæœ¬é¢„ç®—æ§åˆ¶
- SQLiteå†å²è®°å½•
- å¤±è´¥é‡è¯•æœºåˆ¶
